<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Add these lines inside <head> tag -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4F46E5">
<link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%234F46E5' width='100' height='100' rx='20'/%3E%3Ctext x='50' y='70' font-size='60' text-anchor='middle' fill='white' font-family='Arial'%3Eüíµ%3C/text%3E%3C/svg%3E">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bill Tracker</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4F46E5">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%234F46E5' width='100' height='100' rx='20'/%3E%3Ctext x='50' y='70' font-size='60' text-anchor='middle' fill='white' font-family='Arial'%3Eüíµ%3C/text%3E%3C/svg%3E">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        .header h1 {
            color: #4F46E5;
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .current-date {
            color: #6b7280;
            font-size: 1em;
            margin-bottom: 20px;
        }
        
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .summary-item {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .summary-item h3 {
            color: #6b7280;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .summary-item p {
            color: #4F46E5;
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .alerts {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .alerts.hidden {
            display: none;
        }
        
        .alerts h3 {
            color: #92400e;
            margin-bottom: 10px;
        }
        
        .alert-item {
            color: #78350f;
            padding: 5px 0;
        }
        
        .bills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .bill-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .bill-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .bill-card.paid {
            border: 3px solid #10b981;
        }
        
        .bill-card.due-soon {
            border: 3px solid #fbbf24;
        }
        
        .bill-card.overdue {
            border: 3px solid #ef4444;
        }
        
        .bill-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .bill-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #1f2937;
        }
        
        .bill-due {
            background: #4F46E5;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85em;
        }
        
        .bill-status {
            font-size: 2em;
            text-align: center;
            margin: 10px 0;
        }
        
        .bill-details {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #f3f4f6;
        }
        
        .bill-details.hidden {
            display: none;
        }
        
        .input-group {
            margin: 15px 0;
        }
        
        .input-group label {
            display: block;
            color: #6b7280;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .input-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1em;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #4F46E5;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.9em;
            cursor: pointer;
            transition: transform 0.2s;
            flex: 1;
            min-width: 120px;
        }
        
        button:hover {
            transform: scale(1.05);
        }
        
        .btn-primary {
            background: #4F46E5;
            color: white;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-calendar {
            background: #f59e0b;
            color: white;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-header h2 {
            color: #1f2937;
        }
        
        .close-btn {
            background: #ef4444;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
        }
        
        .history-item {
            background: #f9fafb;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .history-stats {
            background: #ede9fe;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .history-stats h3 {
            color: #4F46E5;
            margin-bottom: 10px;
        }
        
        .stat-line {
            padding: 5px 0;
            color: #4b5563;
        }
        
        .tools {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .bills-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üíµ Bill Tracker</h1>
            <div class="current-date" id="currentDate"></div>
            
            <div class="summary">
                <div class="summary-item">
                    <h3>Total Monthly Bills</h3>
                    <p id="totalBills">$0</p>
                </div>
                <div class="summary-item">
                    <h3>Collect by 16th</h3>
                    <p id="collectAmount">$0</p>
                </div>
                <div class="summary-item">
                    <h3>Paid This Month</h3>
                    <p id="paidCount">0/7</p>
                </div>
            </div>
            
            <div id="alerts" class="alerts hidden"></div>
            
            <div class="tools">
                <button class="btn-secondary" onclick="exportData()">üì• Export Backup</button>
                <button class="btn-secondary" onclick="document.getElementById('importFile').click()">üì§ Import Backup</button>
                <input type="file" id="importFile" style="display:none" accept=".json" onchange="importData(event)">
            </div>
        </div>
        
        <div class="bills-grid" id="billsGrid"></div>
    </div>
    
    <div id="historyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Payment History</h2>
                <button class="close-btn" onclick="closeHistory()">√ó</button>
            </div>
            <div id="historyContent"></div>
        </div>
    </div>
    
    <script>
        const bills = [
            { id: 'alares', name: 'Alares Internet', due: 9, emoji: 'üåê' },
            { id: 'condo', name: 'Condominium (Water & Gas)', due: 10, emoji: 'üè¢' },
            { id: 'infinity3404', name: 'Infinity 3404', due: 10, emoji: 'üí≥' },
            { id: 'infinity1704', name: 'Infinity 1704', due: 10, emoji: 'üí≥' },
            { id: 'infinity304', name: 'Infinity 304', due: 10, emoji: 'üí≥' },
            { id: 'mood', name: 'Mood', due: 20, emoji: 'üé≠' },
            { id: 'electricity', name: 'Electricity', due: 25, emoji: '‚ö°' }
        ];
        
        function getCurrentDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return now.toLocaleDateString('en-US', options);
        }
        
        function getCurrentDay() {
            return new Date().getDate();
        }
        
        function getCurrentMonth() {
            return new Date().getMonth();
        }
        
        function getCurrentYear() {
            return new Date().getFullYear();
        }
        
        function loadData() {
            const saved = localStorage.getItem('billTrackerData');
            return saved ? JSON.parse(saved) : {};
        }
        
        function saveData(data) {
            localStorage.setItem('billTrackerData', JSON.stringify(data));
        }
        
        function getBillData(billId) {
            const data = loadData();
            const currentMonth = `${getCurrentYear()}-${getCurrentMonth()}`;
            if (!data[billId]) data[billId] = {};
            if (!data[billId][currentMonth]) {
                data[billId][currentMonth] = { amount: '', paid: false, paidDate: null };
            }
            return data[billId][currentMonth];
        }
        
        function saveBillData(billId, monthData) {
            const data = loadData();
            const currentMonth = `${getCurrentYear()}-${getCurrentMonth()}`;
            if (!data[billId]) data[billId] = {};
            data[billId][currentMonth] = monthData;
            saveData(data);
            updateUI();
        }
        
        function toggleBillDetails(billId) {
            const details = document.getElementById(`details-${billId}`);
            details.classList.toggle('hidden');
        }
        
        function markAsPaid(billId, dueDay) {
            const billData = getBillData(billId);
            billData.paid = true;
            billData.paidDate = getCurrentDay();
            saveBillData(billId, billData);
        }
        
        function updateAmount(billId) {
            const input = document.getElementById(`amount-${billId}`);
            const billData = getBillData(billId);
            const newAmount = parseFloat(input.value) || 0;
            
            const data = loadData();
            const prevMonth = `${getCurrentYear()}-${getCurrentMonth() - 1}`;
            const prevAmount = data[billId] && data[billId][prevMonth] ? (parseFloat(data[billId][prevMonth].amount) || 0) : 0;
            
            if (newAmount > prevAmount && prevAmount > 0) {
                alert(`‚ö†Ô∏è Budget Warning: This amount ($${newAmount}) is higher than last month ($${prevAmount})`);
            }
            
            billData.amount = input.value;
            saveBillData(billId, billData);
        }
        
        function getBillStatus(bill) {
            const billData = getBillData(bill.id);
            const currentDay = getCurrentDay();
            
            if (billData.paid) return 'paid';
            if (currentDay >= bill.due) return 'overdue';
            if (currentDay >= bill.due - 1) return 'due-soon';
            return '';
        }
        
        function getBillStatusEmoji(bill) {
            const status = getBillStatus(bill);
            if (status === 'paid') return '‚úÖ';
            if (status === 'overdue') return 'üî¥';
            if (status === 'due-soon') return '‚ö†Ô∏è';
            return '‚ö™';
        }
        
        function generateAlerts() {
            const currentDay = getCurrentDay();
            const alerts = [];
            
            bills.forEach(bill => {
                const billData = getBillData(bill.id);
                if (!billData.paid && currentDay === bill.due - 1) {
                    alerts.push(`Tomorrow: Pay ${bill.name} ${billData.amount ? '($' + billData.amount + ')' : ''}`);
                }
            });
            
            if (currentDay === 15 || currentDay === 16) {
                const collectBills = bills.filter(b => b.due === 10);
                let total = 0;
                collectBills.forEach(bill => {
                    const billData = getBillData(bill.id);
                    total += parseFloat(billData.amount) || 0;
                });
                if (total > 0) {
                    alerts.push(`üí∞ Reminder: Collect $${total.toFixed(2)} for bills due on the 10th of next month`);
                }
            }
            
            const alertsDiv = document.getElementById('alerts');
            if (alerts.length > 0) {
                alertsDiv.classList.remove('hidden');
                alertsDiv.innerHTML = `<h3>üîî Alerts</h3>` + alerts.map(a => `<div class="alert-item">${a}</div>`).join('');
            } else {
                alertsDiv.classList.add('hidden');
            }
        }
        
        function updateSummary() {
            let total = 0;
            let collectTotal = 0;
            let paidCount = 0;
            
            bills.forEach(bill => {
                const billData = getBillData(bill.id);
                const amount = parseFloat(billData.amount) || 0;
                total += amount;
                
                if (bill.due === 10) {
                    collectTotal += amount;
                }
                
                if (billData.paid) {
                    paidCount++;
                }
            });
            
            document.getElementById('totalBills').textContent = `$${total.toFixed(2)}`;
            document.getElementById('collectAmount').textContent = `$${collectTotal.toFixed(2)}`;
            document.getElementById('paidCount').textContent = `${paidCount}/7`;
        }
        
        function renderBills() {
            const grid = document.getElementById('billsGrid');
            grid.innerHTML = '';
            
            bills.forEach(bill => {
                const billData = getBillData(bill.id);
                const status = getBillStatus(bill);
                
                const card = document.createElement('div');
                card.className = `bill-card ${status}`;
                card.innerHTML = `
                    <div onclick="toggleBillDetails('${bill.id}')">
                        <div class="bill-header">
                            <div class="bill-name">${bill.emoji} ${bill.name}</div>
                            <div class="bill-due">Due ${bill.due}th</div>
                        </div>
                        <div class="bill-status">${getBillStatusEmoji(bill)}</div>
                    </div>
                    
                    <div id="details-${bill.id}" class="bill-details hidden">
                        <div class="input-group">
                            <label>Expected Amount</label>
                            <input type="number" 
                                   id="amount-${bill.id}" 
                                   value="${billData.amount}" 
                                   placeholder="0.00"
                                   onchange="updateAmount('${bill.id}')">
                        </div>
                        
                        <div class="button-group">
                            ${!billData.paid ? 
                                `<button class="btn-success" onclick="markAsPaid('${bill.id}', ${bill.due})">Mark as Paid</button>` :
                                `<button class="btn-success" disabled>‚úì Paid</button>`
                            }
                            <button class="btn-secondary" onclick="showHistory('${bill.id}', '${bill.name}')">Payment History</button>
                            <button class="btn-calendar" onclick="addToCalendar('${bill.id}', '${bill.name}', ${bill.due})">üìÖ Add to Calendar</button>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }
        
        function showHistory(billId, billName) {
            const data = loadData();
            const billHistory = data[billId] || {};
            
            const months = Object.keys(billHistory).sort().reverse();
            
            let totalPaid = 0;
            let onTimeCount = 0;
            let totalCount = 0;
            
            const historyHTML = months.map(monthKey => {
                const [year, month] = monthKey.split('-');
                const monthData = billHistory[monthKey];
                const amount = parseFloat(monthData.amount) || 0;
                
                if (monthData.paid) {
                    totalPaid += amount;
                    totalCount++;
                    
                    const bill = bills.find(b => b.id === billId);
                    const onTime = monthData.paidDate <= bill.due;
                    if (onTime) onTimeCount++;
                    
                    const monthName = new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                    
                    return `
                        <div class="history-item">
                            <strong>${monthName}</strong><br>
                            Amount: $${amount.toFixed(2)} ${onTime ? '‚úÖ On-time' : '‚ö†Ô∏è Late'}
                        </div>
                    `;
                }
                return '';
            }).join('');
            
            const avgAmount = totalCount > 0 ? (totalPaid / totalCount).toFixed(2) : 0;
            const onTimeRate = totalCount > 0 ? ((onTimeCount / totalCount) * 100).toFixed(0) : 0;
            
            const statsHTML = `
                <div class="history-stats">
                    <h3>Statistics</h3>
                    <div class="stat-line"><strong>Total Paid:</strong> $${totalPaid.toFixed(2)}</div>
                    <div class="stat-line"><strong>Average Amount:</strong> $${avgAmount}</div>
                    <div class="stat-line"><strong>On-time Rate:</strong> ${onTimeRate}%</div>
                    <div class="stat-line"><strong>Payments Made:</strong> ${totalCount}</div>
                </div>
            `;
            
            document.getElementById('historyContent').innerHTML = 
                (historyHTML || '<p>No payment history yet.</p>') + statsHTML;
            document.getElementById('historyModal').classList.add('active');
        }
        
        function closeHistory() {
            document.getElementById('historyModal').classList.remove('active');
        }
        
        function addToCalendar(billId, billName, dueDay) {
            const billData = getBillData(billId);
            const amount = billData.amount || 'TBD';
            
            const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Bill Tracker//EN
BEGIN:VEVENT
SUMMARY:Pay ${billName}
DESCRIPTION:Amount: $${amount}
RRULE:FREQ=MONTHLY;BYMONTHDAY=${dueDay - 1}
BEGIN:VALARM
TRIGGER:-P1D
ACTION:DISPLAY
DESCRIPTION:Reminder: Pay ${billName} tomorrow
END:VALARM
END:VEVENT
END:VCALENDAR`;
            
            const blob = new Blob([icsContent], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${billId}-reminder.ics`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function exportData() {
            const data = loadData();
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bill-tracker-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    saveData(data);
                    alert('‚úÖ Data imported successfully!');
                    updateUI();
                } catch (err) {
                    alert('‚ùå Error importing data. Please check the file.');
                }
            };
            reader.readAsText(file);
        }
        
        function updateUI() {
            document.getElementById('currentDate').textContent = `Today: ${getCurrentDate()}`;
            renderBills();
            updateSummary();
            generateAlerts();
        }
        
        updateUI();
    </script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js')
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed'));
        }
    </script>
    <!-- Add this before </body> tag -->
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./service-worker.js')
    .then(reg => console.log('Service Worker registered', reg))
    .catch(err => console.log('Service Worker registration failed', err));
}
</script>
</body>
</html>
